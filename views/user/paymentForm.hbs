<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="../stylesheets/style.css">
  <link rel="image" href="../images">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

  <title>NevKart</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

</head>


<body>
  <div class="row">
    <div class="col-lg-4 col-md-4">

      <a href="" class="text-decoration-none">
        <h1 class="m-0 display-5 font-weight-semi-bold"><span
            class="text-primary font-weight-bold border px-3 mr-1">NEV</span>KART</h1>
      </a>
    </div>
    <div class="col-md-8 col-lg-8">

      <nav class="navbar navbar-expand-lg bg-light navbar-light py-3 py-lg-0 px-0">
        <a href="" class="text-decoration-none d-block d-lg-none">
          <h1 class="m-0 display-5 font-weight-semi-bold"><span
              class="text-primary font-weight-bold border px-3 mr-1"></span></h1>
        </a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
          <div class="navbar-nav mr-auto py-0">
            <a style="font-size:larger ; font-family: cursive" href="home" class=" nav-item nav-link active kk">HOME</a>
            <a style="font-size:larger ; font-family: cursive" href="/getpro/1"
              class="nav-item nav-link active kk">PRODUCTS</a>
            <a style="font-size:larger ; font-family: cursive" href="../../getwishlist"
              class="nav-item nav-link active kk">WISH LIST</a>

            <a style="font-size:larger ; font-family: cursive" href="../../Orderlist"
              class=" nav-item nav-link active kk">ORDER STATUS</a>
            <a style="font-size:larger ; font-family: cursive" href="../../userpro"
              class=" nav-item nav-link active kk">PROFILE</a>
          </div>
          <div class="navbar-nav ml-auto py-0">

            <a style="padding-top: 5%;padding-right: 5%;" href="../../userKart"><span id="cartcount"
                class="badge bg-success">{{this.cartcounts}}</span><svg xmlns="http://www.w3.org/2000/svg" width="30"
                height="30" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
                <path
                  d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l1.313 7h8.17l1.313-7H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
              </svg></a>
            <h4>

              <p>
                {{#if this.userstatus}}

                <span class="glyphicon glyphicon-user"> {{this.user}}</span>
                {{else}}
                <span class="glyphicon glyphicon-user"> </span>
                {{/if}}
              </p>
            </h4>
            {{#if this.userstatus}}
            <div class="d-flex align-items-center ms-lg-auto mt-lg-0 mt-3 pe-2">
              <span class=" me-2 fas fa-phone bg-light rounded-circle"></span>

              <div class="d-flex flex-column ps-2">
                <form action="../../logout" method="post"><button class="btn btn-outline-danger" type="submit">
                    logout</button>
                </form>
              </div>
            </div>
            {{else}}
            <div class="d-flex align-items-center ms-lg-auto mt-lg-0 mt-3 pe-2">
              <span class=" me-2 fas fa-phone bg-light rounded-circle"></span>

              <div class="d-flex flex-column ps-2">
                <form action="../../logout" method="post"><button class="btn btn-outline-success" type="submit">
                    Login</button>
                </form>
              </div>
            </div>
            {{/if}}
          </div>
        </div>
      </nav>
    </div>
  </div>





  {{!--
  ----------------------------------------------------------------------------------------------------------------------------------------------------
  --}}
  {{!--
  =================================================================================================================================================
  --}}

  <!-- Topbar End -->



  <!-- Navbar End -->



  <!-- Page Header End -->


  <!-- Checkout Start -->
  <div class="container-fluid pt-5">

    <div class="row px-xl-5">
      <div class="col-lg-12">
        <div class="mb-4">
          <h4 class="font-weight-semi-bold mb-4">Billing Address</h4>
          <div class="row">




            <div class="col-md-6 form-group">
              <div class="custom-control custom-checkbox">
                <label class="custom-control-label" for="shipto" data-toggle="collapse" data-target="#shipping-address">
                  Click here to Add Address</label>
              </div>
              <div class="collapse mb-4" id="shipping-address">
                <form id="userAddress" style="background-color:rgb(208, 255, 255) ;">
                  <h4 class="font-weight-semi-bold mb-4">Shipping Address</h4>
                  <div class="row">
                    <div class="col-md-6 form-group">
                      <label>First Name</label>
                      <input name="name" required class="form-control" type="text" placeholder="Billing name">
                    </div>

                    <div class="col-md-6 form-group">
                      <label>E-mail</label>
                      <input name="email" required class="form-control" type="email" placeholder="Billing Mail">
                    </div>
                    <div class="col-md-6 form-group">
                      <label>Mobile No</label>
                      <input name="Mobilenumber" required class="form-control" type="number" placeholder="Billing MOb number">
                    </div>
                    <div class="col-md-6 form-group">
                      <label>Address Line 1</label>
                      <input name="deliveryaddress" required class="form-control" type="text" placeholder="Biling address">
                    </div>


                    <div class="col-md-6 form-group">
                      <label>City</label>
                      <input name="city" class="form-control" type="text" placeholder="Your city">
                    </div>
                    <div class="col-md-6 form-group">
                      <label>State</label>
                      <input name="state" class="form-control" type="text" placeholder="Your state/province">
                    </div>
                    <div class="col-md-6 form-group">
                      <label>ZIP Code</label>
                      <input name="zipCode" class="form-control" type="text" placeholder="Zipcode of yours">
                    </div>
                  </div>
                  <button class="btn btn-outline-warning" type="submit">Add Address</button>
                </form>



              </div>
              <form action="/coupon" method="post">

                <div class="card mb-4">

                  <div class="card-body p-4 d-flex flex-row">
                    <div class="form-outline flex-fill">
                      <input name="couponName" type="text" id="form1" class="form-control form-control-lg" />
                      <label class="form-label" for="form1">Discount code</label>
                    </div>
                    <button type="submit" class="btn btn-outline-warning btn-lg ms-3">Apply</button>

                  </div>
                  {{#if discount}}
                  <h4 style="color: green;">Coupon Applied Succesfully</h4>
                  <a style=" text-decoration: none;" href="removecoupon">
                    <h6 style="color: red;"> Click here to remove coupon</h6>
                  </a>
                  {{else}}
                  {{#if couponerror}}
                  <h4>{{couponerror}}</h4>
                  {{/if}} {{/if}}
                </div>
              </form>
            </div>


            <div class="col-lg-6">




              <form id="check" method="post">
                <div class="col-lg-12">
                  {{#each userd}}
                  <div style="background-color:rgb(198, 255, 255) ; border-radius:10px ;" class="form-check">

                    <input class="form-check-input" type="radio" value="{{this.Addid}}" name="flexRadioDefault"
                      id="flexRadioDefault1">
                    <label class="form-check-label" for="flexRadioDefault1">

                      <h6>{{this.name}}</h6>
                      <h6>{{this.userdMobilenumber}}</h6>
                      <h6>{{this.deliveryaddress}}</h6>
                      <h6>{{this.city}}</h6>
                      <h6>{{this.state}}</h6>
                      <h6>{{this.zipCode}}</h6>

                    </label>
                  </div>
                  {{/each}}
                  <div class="card border-secondary mb-5">
                    <div class="card-header bg-secondary border-0">
                      <h4 class="font-weight-semi-bold m-0">Order Total</h4>
                    </div>
                    <div class="card-body">
                      <h5 class="font-weight-medium mb-3">Products</h5>
                      {{#each cartproducts}}
                      <div class="d-flex justify-content-between">
                        <input name="productName" style="display: none;" type="text" value="{{this.product.product.productname}}">
                        <p>{{this.product.product.productname}}</p>
                         <input name="stock" style="display: none;" type="text" value="{{this.stock}}">
                        <p>Nos:{{this.stock}}</p>
                      </div>
                      {{/each}}

                      <hr class="mt-0">


                    </div>
                    <div class="card-footer border-secondary bg-transparent">
                      {{#if discount}}
                      <div class="d-flex justify-content-between mt-2">
                        <h5 class="font-weight-bold">Total</h5>
                        <h5 class="font-weight-bold"> <strike> ₹ {{total}} </strike></h5>
                      </div>

                      <div class="d-flex justify-content-between mt-2">
                        <input style="display: none;" name="couponName" type="text" value="{{coupon}}">
                        <h5>Discount </h5>
                        <h5>-₹ {{discount}}</h5>
                        <input hidden name="discountAmount" value="{{discount}}" type="text">
                      </div>
                      <hr class="mt-0">
                      <div class="d-flex justify-content-between mt-2">
                        <h5 class="font-weight-bold">Updated Total</h5>
                        <input hidden name="totalprice" value="{{newPrice}}" type="text">
                        <input hidden name="Oldtotalprice" value="{{total}}" type="text">
                        <h5 class="font-weight-bold">₹ {{newPrice}}</h5>
                      </div>
                      {{else}}
                      <div class="d-flex justify-content-between mt-2">
                        <h5 class="font-weight-bold">Total</h5>
                        <input hidden name="totalprice" value="{{total}}" type="text">
                        <h5 class="font-weight-bold">₹ {{total}}</h5>
                      </div>
                      {{/if}}
                    </div>
                  </div>

                  <div class="card border-secondary mb-5">
                    <div class="card-header bg-secondary border-0">
                      <h4 class="font-weight-semi-bold m-0">Payment</h4>
                    </div>
                    <div class="card-body">

                      <select name="paymentType" required class="form-select" aria-label="Default select example">
                        <option selected>select payment method</option>
                        <option value="Cash On Delivery">Cash On Delivery</option>
                        <option value="Paypal">Paypal</option>
                         <option value="Internet Banking">Razor pay</option>
                        {{#if Iswallet}}
                        <option style="color: green;" value="Wallet">Wallet Payment Available</option>
                        {{else}}
                        <option style="color: red;" disabled value="Wallet">Wallet Balance is Low !!</option>
                        {{/if}}
                      </select>

                    </div>
                    <div class="card-footer border-secondary bg-transparent">
                      <button type="submit" class="btn btn-lg btn-block btn-primary font-weight-bold my-3 py-3">Place
                        Order</button>
                    </div>
                  </div>
                </div>
              </form>
            </div>

          </div>

        </div>


      </div>

    </div>
  </div>

  <!-- Checkout End -->



  <!-- Footer Start -->
  <div class="container-fluid bg-secondary text-dark mt-5 pt-5">
    <div class="row px-xl-5 pt-5">
      <div class="col-lg-4 col-md-12 mb-5 pr-3 pr-xl-5">
        <a href="" class="text-decoration-none">
          <h1 class="mb-4 display-5 font-weight-semi-bold"><span
              class="text-primary font-weight-bold border border-white px-3 mr-1">E</span>Shopper</h1>
        </a>
        <p>Dolore erat dolor sit lorem vero amet. Sed sit lorem magna, ipsum no sit erat lorem et magna ipsum dolore
          amet erat.</p>
        <p class="mb-2"><i class="fa fa-map-marker-alt text-primary mr-3"></i>123 Street, New York, USA</p>
        <p class="mb-2"><i class="fa fa-envelope text-primary mr-3"></i>info@example.com</p>
        <p class="mb-0"><i class="fa fa-phone-alt text-primary mr-3"></i>+012 345 67890</p>
      </div>
      <div class="col-lg-8 col-md-12">
        <div class="row">
          <div class="col-md-4 mb-5">
            <h5 class="font-weight-bold text-dark mb-4">Quick Links</h5>
            <div class="d-flex flex-column justify-content-start">
              <a class="text-dark mb-2" href="index.html"><i class="fa fa-angle-right mr-2"></i>Home</a>
              <a class="text-dark mb-2" href="shop.html"><i class="fa fa-angle-right mr-2"></i>Our Shop</a>
              <a class="text-dark mb-2" href="detail.html"><i class="fa fa-angle-right mr-2"></i>Shop Detail</a>
              <a class="text-dark mb-2" href="cart.html"><i class="fa fa-angle-right mr-2"></i>Shopping Cart</a>
              <a class="text-dark mb-2" href="checkout.html"><i class="fa fa-angle-right mr-2"></i>Checkout</a>
              <a class="text-dark" href="contact.html"><i class="fa fa-angle-right mr-2"></i>Contact Us</a>
            </div>
          </div>
          <div class="col-md-4 mb-5">
            <h5 class="font-weight-bold text-dark mb-4">Quick Links</h5>
            <div class="d-flex flex-column justify-content-start">
              <a class="text-dark mb-2" href="index.html"><i class="fa fa-angle-right mr-2"></i>Home</a>
              <a class="text-dark mb-2" href="shop.html"><i class="fa fa-angle-right mr-2"></i>Our Shop</a>
              <a class="text-dark mb-2" href="detail.html"><i class="fa fa-angle-right mr-2"></i>Shop Detail</a>
              <a class="text-dark mb-2" href="cart.html"><i class="fa fa-angle-right mr-2"></i>Shopping Cart</a>
              <a class="text-dark mb-2" href="checkout.html"><i class="fa fa-angle-right mr-2"></i>Checkout</a>
              <a class="text-dark" href="contact.html"><i class="fa fa-angle-right mr-2"></i>Contact Us</a>
            </div>
          </div>
          <div class="col-md-4 mb-5">
            <h5 class="font-weight-bold text-dark mb-4">Newsletter</h5>
            <form action="">
              <div class="form-group">
                <input type="text" class="form-control border-0 py-4" placeholder="Your Name" required="required" />
              </div>
              <div class="form-group">
                <input type="email" class="form-control border-0 py-4" placeholder="Your Email" required="required" />
              </div>
              <div>
                <button class="btn btn-primary btn-block border-0 py-3" type="submit">Subscribe Now</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="row border-top border-light mx-xl-5 py-4">
      <div class="col-md-6 px-xl-0">
        <p class="mb-md-0 text-center text-md-left text-dark">
          &copy; <a class="text-dark font-weight-semi-bold" href="#">Your Site Name</a>. All Rights Reserved. Designed
          by
          <a class="text-dark font-weight-semi-bold" href="https://htmlcodex.com">HTML Codex</a>
        </p>
      </div>
      <div class="col-md-6 px-xl-0 text-center text-md-right">
        <img class="img-fluid" src="img/payments.png" alt="">
      </div>
    </div>
  </div>
  <!-- Footer End -->

  <!-- Back to Top -->
  <a href="#" class="btn btn-primary back-to-top"><i class="fa fa-angle-double-up"></i></a>
  {{!-- razorpay --}}


  <!-- JavaScript Libraries -->

  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
  <script src="lib/easing/easing.min.js"></script>
  <script src="lib/owlcarousel/owl.carousel.min.js"></script>

  <!-- Contact Javascript File -->
  <script src="mail/jqBootstrapValidation.min.js"></script>
  <script src="mail/contact.js"></script>

  <!-- Template Javascript -->
  <script src="js/main.js"></script>
  {{!--
  ==========================================================END===============================================================================================================
  --}}



  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" {{!--
    integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
    crossorigin="anonymous"></script> --}}
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
    integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
    crossorigin="anonymous"></script>
  <script src="/javascripts/script.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>


  <script>
    $('#userAddress').submit((e) => {
      e.preventDefault()
      $.ajax({
        url: "/saveaddress",
        method: 'post',
        data: $('#userAddress').serialize(),
        success: (resp) => {
          
          location.reload(true)
        }
      })
    })
  </script>
  <script>
    $('#check').submit((e) => {
      e.preventDefault()
      $.ajax({
        url: '/paymentdone',
        method: 'post',
        data: $('#check').serialize(),
        success: (resp) => {
          alert(resp)
          console.log("resp resp rsp", resp)
          if (resp.codstatus) {

            location.href = '/Orderconfirmed'

          }
          else if(resp.paypalstatus){
              location.href = resp.link
          } else {

            Razorpayment(resp)

          }
          function Razorpayment(resp) {
            console.log("hhhhhh")
            var options = {
              "key": "rzp_test_9JuKTUdvSUARFP", // Enter the Key ID generated from the Dashboard
              "amount": resp.order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
              "currency": "INR",
              "name": "NevKart",
              "description": "Test Transaction",
              "image": "https://example.com/your_logo",
              "order_id": resp.order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
              "handler": function (response) {


                Razorpaymentdone(response, resp)
              },
              "prefill": {
                "name": "Gaurav Kumar",
                "email": "gaurav.kumar@example.com",
                "contact": "9999999999"
              },
              "notes": {
                "address": "Razorpay Corporate Office"
              },
              "theme": {
                "color": "#3399cc"
              }
            };
            var rzp1 = new Razorpay(options);
            rzp1.open();

          }

        }
      })
    })
    function Razorpaymentdone(response, resp) {
      $.ajax({
        url: '/verifypayment',
        data: {
          response, resp
        },
        method: 'post',
        success: (response) => {
          console.log(response)
          if (response.status) {

            location.href = '/orderdone'
          } else {
            alert('Payment Failed')
          }
        }
      })
    }
  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
    integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
    integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
    crossorigin="anonymous"></script>
  <script src="/javascripts/script.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js">
  </script>
</body>

</html>